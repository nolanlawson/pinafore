import { isEmojiSupported, setCacheHandler } from 'is-emoji-supported'
import { QuickLRU } from '../_thirdparty/quick-lru/quick-lru.js'
import { store } from '../_store/store.js'

// avoid recomputing emoji support over and over again
// use our own LRU since the built-in one grows forever, which is a small memory leak, but still
setCacheHandler(new QuickLRU({ maxSize: 500 }))

const COUNTRY_FLAG_EMOJI = new Set(
  [
    'ğŸ‡¦ğŸ‡¨',
    'ğŸ‡¦ğŸ‡©',
    'ğŸ‡¦ğŸ‡ª',
    'ğŸ‡¦ğŸ‡«',
    'ğŸ‡¦ğŸ‡¬',
    'ğŸ‡¦ğŸ‡®',
    'ğŸ‡¦ğŸ‡±',
    'ğŸ‡¦ğŸ‡²',
    'ğŸ‡¦ğŸ‡´',
    'ğŸ‡¦ğŸ‡¶',
    'ğŸ‡¦ğŸ‡·',
    'ğŸ‡¦ğŸ‡¸',
    'ğŸ‡¦ğŸ‡¹',
    'ğŸ‡¦ğŸ‡º',
    'ğŸ‡¦ğŸ‡¼',
    'ğŸ‡¦ğŸ‡½',
    'ğŸ‡¦ğŸ‡¿',
    'ğŸ‡§ğŸ‡¦',
    'ğŸ‡§ğŸ‡§',
    'ğŸ‡§ğŸ‡©',
    'ğŸ‡§ğŸ‡ª',
    'ğŸ‡§ğŸ‡«',
    'ğŸ‡§ğŸ‡¬',
    'ğŸ‡§ğŸ‡­',
    'ğŸ‡§ğŸ‡®',
    'ğŸ‡§ğŸ‡¯',
    'ğŸ‡§ğŸ‡±',
    'ğŸ‡§ğŸ‡²',
    'ğŸ‡§ğŸ‡³',
    'ğŸ‡§ğŸ‡´',
    'ğŸ‡§ğŸ‡¶',
    'ğŸ‡§ğŸ‡·',
    'ğŸ‡§ğŸ‡¸',
    'ğŸ‡§ğŸ‡¹',
    'ğŸ‡§ğŸ‡»',
    'ğŸ‡§ğŸ‡¼',
    'ğŸ‡§ğŸ‡¾',
    'ğŸ‡§ğŸ‡¿',
    'ğŸ‡¨ğŸ‡¦',
    'ğŸ‡¨ğŸ‡¨',
    'ğŸ‡¨ğŸ‡©',
    'ğŸ‡¨ğŸ‡«',
    'ğŸ‡¨ğŸ‡¬',
    'ğŸ‡¨ğŸ‡­',
    'ğŸ‡¨ğŸ‡®',
    'ğŸ‡¨ğŸ‡°',
    'ğŸ‡¨ğŸ‡±',
    'ğŸ‡¨ğŸ‡²',
    'ğŸ‡¨ğŸ‡³',
    'ğŸ‡¨ğŸ‡´',
    'ğŸ‡¨ğŸ‡µ',
    'ğŸ‡¨ğŸ‡·',
    'ğŸ‡¨ğŸ‡º',
    'ğŸ‡¨ğŸ‡»',
    'ğŸ‡¨ğŸ‡¼',
    'ğŸ‡¨ğŸ‡½',
    'ğŸ‡¨ğŸ‡¾',
    'ğŸ‡¨ğŸ‡¿',
    'ğŸ‡©ğŸ‡ª',
    'ğŸ‡©ğŸ‡¬',
    'ğŸ‡©ğŸ‡¯',
    'ğŸ‡©ğŸ‡°',
    'ğŸ‡©ğŸ‡²',
    'ğŸ‡©ğŸ‡´',
    'ğŸ‡©ğŸ‡¿',
    'ğŸ‡ªğŸ‡¦',
    'ğŸ‡ªğŸ‡¨',
    'ğŸ‡ªğŸ‡ª',
    'ğŸ‡ªğŸ‡¬',
    'ğŸ‡ªğŸ‡­',
    'ğŸ‡ªğŸ‡·',
    'ğŸ‡ªğŸ‡¸',
    'ğŸ‡ªğŸ‡¹',
    'ğŸ‡ªğŸ‡º',
    'ğŸ‡«ğŸ‡®',
    'ğŸ‡«ğŸ‡¯',
    'ğŸ‡«ğŸ‡°',
    'ğŸ‡«ğŸ‡²',
    'ğŸ‡«ğŸ‡´',
    'ğŸ‡«ğŸ‡·',
    'ğŸ‡¬ğŸ‡¦',
    'ğŸ‡¬ğŸ‡§',
    'ğŸ‡¬ğŸ‡©',
    'ğŸ‡¬ğŸ‡ª',
    'ğŸ‡¬ğŸ‡«',
    'ğŸ‡¬ğŸ‡¬',
    'ğŸ‡¬ğŸ‡­',
    'ğŸ‡¬ğŸ‡®',
    'ğŸ‡¬ğŸ‡±',
    'ğŸ‡¬ğŸ‡²',
    'ğŸ‡¬ğŸ‡³',
    'ğŸ‡¬ğŸ‡µ',
    'ğŸ‡¬ğŸ‡¶',
    'ğŸ‡¬ğŸ‡·',
    'ğŸ‡¬ğŸ‡¸',
    'ğŸ‡¬ğŸ‡¹',
    'ğŸ‡¬ğŸ‡º',
    'ğŸ‡¬ğŸ‡¼',
    'ğŸ‡¬ğŸ‡¾',
    'ğŸ‡­ğŸ‡°',
    'ğŸ‡­ğŸ‡²',
    'ğŸ‡­ğŸ‡³',
    'ğŸ‡­ğŸ‡·',
    'ğŸ‡­ğŸ‡¹',
    'ğŸ‡­ğŸ‡º',
    'ğŸ‡®ğŸ‡¨',
    'ğŸ‡®ğŸ‡©',
    'ğŸ‡®ğŸ‡ª',
    'ğŸ‡®ğŸ‡±',
    'ğŸ‡®ğŸ‡²',
    'ğŸ‡®ğŸ‡³',
    'ğŸ‡®ğŸ‡´',
    'ğŸ‡®ğŸ‡¶',
    'ğŸ‡®ğŸ‡·',
    'ğŸ‡®ğŸ‡¸',
    'ğŸ‡®ğŸ‡¹',
    'ğŸ‡¯ğŸ‡ª',
    'ğŸ‡¯ğŸ‡²',
    'ğŸ‡¯ğŸ‡´',
    'ğŸ‡¯ğŸ‡µ',
    'ğŸ‡°ğŸ‡ª',
    'ğŸ‡°ğŸ‡¬',
    'ğŸ‡°ğŸ‡­',
    'ğŸ‡°ğŸ‡®',
    'ğŸ‡°ğŸ‡²',
    'ğŸ‡°ğŸ‡³',
    'ğŸ‡°ğŸ‡µ',
    'ğŸ‡°ğŸ‡·',
    'ğŸ‡°ğŸ‡¼',
    'ğŸ‡°ğŸ‡¾',
    'ğŸ‡°ğŸ‡¿',
    'ğŸ‡±ğŸ‡¦',
    'ğŸ‡±ğŸ‡§',
    'ğŸ‡±ğŸ‡¨',
    'ğŸ‡±ğŸ‡®',
    'ğŸ‡±ğŸ‡°',
    'ğŸ‡±ğŸ‡·',
    'ğŸ‡±ğŸ‡¸',
    'ğŸ‡±ğŸ‡¹',
    'ğŸ‡±ğŸ‡º',
    'ğŸ‡±ğŸ‡»',
    'ğŸ‡±ğŸ‡¾',
    'ğŸ‡²ğŸ‡¦',
    'ğŸ‡²ğŸ‡¨',
    'ğŸ‡²ğŸ‡©',
    'ğŸ‡²ğŸ‡ª',
    'ğŸ‡²ğŸ‡«',
    'ğŸ‡²ğŸ‡¬',
    'ğŸ‡²ğŸ‡­',
    'ğŸ‡²ğŸ‡°',
    'ğŸ‡²ğŸ‡±',
    'ğŸ‡²ğŸ‡²',
    'ğŸ‡²ğŸ‡³',
    'ğŸ‡²ğŸ‡´',
    'ğŸ‡²ğŸ‡µ',
    'ğŸ‡²ğŸ‡¶',
    'ğŸ‡²ğŸ‡·',
    'ğŸ‡²ğŸ‡¸',
    'ğŸ‡²ğŸ‡¹',
    'ğŸ‡²ğŸ‡º',
    'ğŸ‡²ğŸ‡»',
    'ğŸ‡²ğŸ‡¼',
    'ğŸ‡²ğŸ‡½',
    'ğŸ‡²ğŸ‡¾',
    'ğŸ‡²ğŸ‡¿',
    'ğŸ‡³ğŸ‡¦',
    'ğŸ‡³ğŸ‡¨',
    'ğŸ‡³ğŸ‡ª',
    'ğŸ‡³ğŸ‡«',
    'ğŸ‡³ğŸ‡¬',
    'ğŸ‡³ğŸ‡®',
    'ğŸ‡³ğŸ‡±',
    'ğŸ‡³ğŸ‡´',
    'ğŸ‡³ğŸ‡µ',
    'ğŸ‡³ğŸ‡·',
    'ğŸ‡³ğŸ‡º',
    'ğŸ‡³ğŸ‡¿',
    'ğŸ‡´ğŸ‡²',
    'ğŸ‡µğŸ‡¦',
    'ğŸ‡µğŸ‡ª',
    'ğŸ‡µğŸ‡«',
    'ğŸ‡µğŸ‡¬',
    'ğŸ‡µğŸ‡­',
    'ğŸ‡µğŸ‡°',
    'ğŸ‡µğŸ‡±',
    'ğŸ‡µğŸ‡²',
    'ğŸ‡µğŸ‡³',
    'ğŸ‡µğŸ‡·',
    'ğŸ‡µğŸ‡¸',
    'ğŸ‡µğŸ‡¹',
    'ğŸ‡µğŸ‡¼',
    'ğŸ‡µğŸ‡¾',
    'ğŸ‡¶ğŸ‡¦',
    'ğŸ‡·ğŸ‡ª',
    'ğŸ‡·ğŸ‡´',
    'ğŸ‡·ğŸ‡¸',
    'ğŸ‡·ğŸ‡º',
    'ğŸ‡·ğŸ‡¼',
    'ğŸ‡¸ğŸ‡¦',
    'ğŸ‡¸ğŸ‡§',
    'ğŸ‡¸ğŸ‡¨',
    'ğŸ‡¸ğŸ‡©',
    'ğŸ‡¸ğŸ‡ª',
    'ğŸ‡¸ğŸ‡¬',
    'ğŸ‡¸ğŸ‡­',
    'ğŸ‡¸ğŸ‡®',
    'ğŸ‡¸ğŸ‡¯',
    'ğŸ‡¸ğŸ‡°',
    'ğŸ‡¸ğŸ‡±',
    'ğŸ‡¸ğŸ‡²',
    'ğŸ‡¸ğŸ‡³',
    'ğŸ‡¸ğŸ‡´',
    'ğŸ‡¸ğŸ‡·',
    'ğŸ‡¸ğŸ‡¸',
    'ğŸ‡¸ğŸ‡¹',
    'ğŸ‡¸ğŸ‡»',
    'ğŸ‡¸ğŸ‡½',
    'ğŸ‡¸ğŸ‡¾',
    'ğŸ‡¸ğŸ‡¿',
    'ğŸ‡¹ğŸ‡¦',
    'ğŸ‡¹ğŸ‡¨',
    'ğŸ‡¹ğŸ‡©',
    'ğŸ‡¹ğŸ‡«',
    'ğŸ‡¹ğŸ‡¬',
    'ğŸ‡¹ğŸ‡­',
    'ğŸ‡¹ğŸ‡¯',
    'ğŸ‡¹ğŸ‡°',
    'ğŸ‡¹ğŸ‡±',
    'ğŸ‡¹ğŸ‡²',
    'ğŸ‡¹ğŸ‡³',
    'ğŸ‡¹ğŸ‡´',
    'ğŸ‡¹ğŸ‡·',
    'ğŸ‡¹ğŸ‡¹',
    'ğŸ‡¹ğŸ‡»',
    'ğŸ‡¹ğŸ‡¼',
    'ğŸ‡¹ğŸ‡¿',
    'ğŸ‡ºğŸ‡¦',
    'ğŸ‡ºğŸ‡¬',
    'ğŸ‡ºğŸ‡²',
    'ğŸ‡ºğŸ‡³',
    'ğŸ‡ºğŸ‡¸',
    'ğŸ‡ºğŸ‡¾',
    'ğŸ‡ºğŸ‡¿',
    'ğŸ‡»ğŸ‡¦',
    'ğŸ‡»ğŸ‡¨',
    'ğŸ‡»ğŸ‡ª',
    'ğŸ‡»ğŸ‡¬',
    'ğŸ‡»ğŸ‡®',
    'ğŸ‡»ğŸ‡³',
    'ğŸ‡»ğŸ‡º',
    'ğŸ‡¼ğŸ‡«',
    'ğŸ‡¼ğŸ‡¸',
    'ğŸ‡½ğŸ‡°',
    'ğŸ‡¾ğŸ‡ª',
    'ğŸ‡¾ğŸ‡¹',
    'ğŸ‡¿ğŸ‡¦',
    'ğŸ‡¿ğŸ‡²',
    'ğŸ‡¿ğŸ‡¼',
    'ğŸ´ó §ó ¢ó ¥ó ®ó §ó ¿',
    'ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿',
    'ğŸ´ó §ó ¢ó ·ó ¬ó ³ó ¿'
  ]
)

export function testEmojiSupported (unicode) {
  if (store.get().polyfilledCountryFlagEmoji && COUNTRY_FLAG_EMOJI.has(unicode)) {
    return true // just assume it's supported; is-emoji-supported doesn't work in this case
  }
  return isEmojiSupported(unicode)
}
